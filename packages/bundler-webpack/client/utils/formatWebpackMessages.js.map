{
  "version": 3,
  "sources": ["../../src/utils/formatWebpackMessages.ts"],
  "sourcesContent": ["import stripAnsi from '@umijs/utils/compiled/strip-ansi';\n\nconst friendlySyntaxErrorLabel = 'Syntax error:';\n\nfunction isLikelyASyntaxError(message: string): boolean {\n  return stripAnsi(message).indexOf(friendlySyntaxErrorLabel) !== -1;\n}\n\nexport function formatMessage(\n  message: string | { message: string } | { message: string }[],\n) {\n  let lines: string[] = [];\n  if (typeof message === 'string') {\n    lines = message.split('\\n');\n  } else if ('message' in message) {\n    lines = message['message'].split('\\n');\n  } else if (Array.isArray(message)) {\n    message.forEach((message) => {\n      if ('message' in message) {\n        lines = message['message'].split('\\n');\n      }\n    });\n  }\n\n  // Strip webpack-added headers off errors/warnings\n  // https://github.com/webpack/webpack/blob/master/lib/ModuleError.js\n  lines = lines.filter((line) => !/Module [A-z ]+\\(from/.test(line));\n\n  // Transform parsing error into syntax error\n  // TODO: move this to our ESLint formatter?\n  lines = lines.map((line) => {\n    const parsingError = /Line (\\d+):(?:(\\d+):)?\\s*Parsing error: (.+)$/.exec(\n      line,\n    );\n    if (!parsingError) {\n      return line;\n    }\n    const [, errorLine, errorColumn, errorMessage] = parsingError;\n    return `${friendlySyntaxErrorLabel} ${errorMessage} (${errorLine}:${errorColumn})`;\n  });\n\n  message = lines.join('\\n');\n  // Smoosh syntax errors (commonly found in CSS)\n  message = message.replace(\n    /SyntaxError\\s+\\((\\d+):(\\d+)\\)\\s*(.+?)\\n/g,\n    `${friendlySyntaxErrorLabel} $3 ($1:$2)\\n`,\n  );\n  // Clean up export errors\n  message = message.replace(\n    /^.*export '(.+?)' was not found in '(.+?)'.*$/gm,\n    `Attempted import error: '$1' is not exported from '$2'.`,\n  );\n  message = message.replace(\n    /^.*export 'default' \\(imported as '(.+?)'\\) was not found in '(.+?)'.*$/gm,\n    `Attempted import error: '$2' does not contain a default export (imported as '$1').`,\n  );\n  message = message.replace(\n    /^.*export '(.+?)' \\(imported as '(.+?)'\\) was not found in '(.+?)'.*$/gm,\n    `Attempted import error: '$1' is not exported from '$3' (imported as '$2').`,\n  );\n  lines = message.split('\\n');\n\n  // Remove leading newline\n  if (lines.length > 2 && lines[1].trim() === '') {\n    lines.splice(1, 1);\n  }\n  // Clean up file name\n  lines[0] = lines[0].replace(/^(.*) \\d+:\\d+-\\d+$/, '$1');\n\n  // Cleans up verbose \"module not found\" messages for files and packages.\n  if (lines[1] && lines[1].indexOf('Module not found: ') === 0) {\n    lines = [\n      lines[0],\n      lines[1]\n        .replace('Error: ', '')\n        .replace('Module not found: Cannot find file:', 'Cannot find file:'),\n    ];\n  }\n\n  // Add helpful message for users trying to use Sass for the first time\n  if (lines[1] && lines[1].match(/Cannot find module.+sass/)) {\n    lines[1] = 'To import Sass files, you first need to install sass.\\n';\n    lines[1] +=\n      'Run `npm install sass` or `yarn add sass` inside your workspace.';\n  }\n\n  message = lines.join('\\n');\n  // Internal stacks are generally useless so we strip them... with the\n  // exception of stacks containing `webpack:` because they're normally\n  // from user code generated by webpack. For more information see\n  // https://github.com/facebook/create-react-app/pull/1050\n  message = message.replace(\n    /^\\s*at\\s((?!webpack:).)*:\\d+:\\d+[\\s)]*(\\n|$)/gm,\n    '',\n  ); // at ... ...:x:y\n  message = message.replace(/^\\s*at\\s<anonymous>(\\n|$)/gm, ''); // at <anonymous>\n  lines = message.split('\\n');\n\n  // Remove duplicated newlines\n  lines = lines.filter(\n    (line, index, arr) =>\n      index === 0 ||\n      line.trim() !== '' ||\n      line.trim() !== arr[index - 1].trim(),\n  );\n\n  // Reassemble the message\n  message = lines.join('\\n');\n  return message.trim();\n}\n\nexport function formatWebpackMessages(json: {\n  errors: string[];\n  warnings: string[];\n}) {\n  const formattedErrors = json.errors.map(function (message) {\n    return formatMessage(message);\n  });\n  const formattedWarnings = json.warnings.map(function (message) {\n    return formatMessage(message);\n  });\n  const result = { errors: formattedErrors, warnings: formattedWarnings };\n  if (result.errors.some(isLikelyASyntaxError)) {\n    // If there are any syntax errors, show just them.\n    result.errors = result.errors.filter(isLikelyASyntaxError);\n  }\n  return result;\n}\n"],
  "mappings": "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",
  "names": ["message"]
}
